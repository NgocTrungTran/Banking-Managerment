<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List Customer</title>
    <link rel="shortcut icon" href="https://vanphongxanh.vn/wp-content/uploads/2022/03/logo-social.png">
    <link rel="stylesheet" href="./assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="./assets/node_modules/fontawesome-4.7/css/font-awesome.min.css">
    <link rel="stylesheet" href="./assets/node_modules/sweetalert2/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="./assets/css/style.css">
</head>

<body>

    <div class="container" id="container">
        <div class="table-title">
            <div class="row">
                <div class="col-sm-5">
                    <h1>List of customers</h1>
                </div>
                <div class="col-sm-7">
                    <button class="btn btn-outline-light" type="button" data-bs-toggle="modal"
                        data-bs-target="#staticBackdrop">
                        <i class="fa fa-plus-square-o" aria-hidden="true"></i>
                        <span>Add New Customer</span>
                    </button>

                    <a class="btn btn-outline-light transferInfo" type="button" href="transferInfo.html">
                        <i class="fa fa-history" aria-hidden="true"></i>
                        <span>Transfer money Information</span>
                    </a>
                </div>
            </div>
        </div>
        <table class="table table-hover table-bordered" id="tbCustomer">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Fullname</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Address</th>
                    <th>Balance</th>
                    <th colspan="5" style="text-align: center;">Action</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    </div>
    <!-- End container -->

    <!-- Craete Modal -->
    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Add new customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="frmCreate" action="">
                        <div class="row mt-3">
                            <div class="col-lg-6">
                                <label for="fullName" class="fw-bold">Full Name</label>
                                <input type="text" id="fullName" name="fullName" class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="email" class="fw-bold">Email</label>
                                <input type="text" id="email" name="email" class="form-control">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-lg-6">
                                <label for="phone" class="fw-bold">Phone</label>
                                <input type="text" id="phone" name="phone" class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="address" class="fw-bold">Address</label>
                                <input type="text" id="address" name="address" class="form-control">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-lg-12">
                                <button type="reset" class="btn btn-outline-secondary">Reset</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnCreate">Create</button>
                </div>
            </div>
        </div>
    </div>
    <!-- end create modal -->

    <!-- Update Modal -->
    <div class="modal fade" id="mdUpdate" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Update</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="frmUpdate" action="">
                        <div class="row mt-3">
                            <input type="hidden" id="idUp">
                            <input type="hidden" id="balanceUp">
                            <div class="col-lg-6">
                                <label for="fullNameUp" class="fw-bold">Full Name</label>
                                <input type="text" id="fullNameUp" name="fullNameUp" class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="emailUp" class="fw-bold">Email</label>
                                <input type="text" id="emailUp" name="emailUp" class="form-control">
                            </div>
                        </div>
                        <div class="row mt-3 mb-3">
                            <div class="col-lg-6">
                                <label for="phoneUp" class="fw-bold">Phone</label>
                                <input type="text" id="phoneUp" name="phoneUp" class="form-control">
                            </div>
                            <div class="col-lg-6">
                                <label for="addressUp" class="fw-bold">Address</label>
                                <input type="text" id="addressUp" name="addressUp" class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="btnUpdate" class="btn btn-outline-secondary">
                        <i class="fa-solid fa-pen-to-square"></i>
                        Save changes
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- End update modal -->

    <!-- Delete modal -->
    <div class="modal fade" id="mdDelete" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="frmDelete" action="">
                        <div class="row mt-3">
                            <input type="hidden" id="idDel">
                            <div class="col-lg-6">
                                <label for="fullNameUp" class="fw-bold">Full Name</label>
                                <input type="text" id="fullNameDel" name="fullNameDel" class="form-control" readonly>
                            </div>
                            <div class="col-lg-6">
                                <label for="emailUp" class="fw-bold">Email</label>
                                <input type="text" id="emailDel" name="emailDel" class="form-control" readonly>
                            </div>
                        </div>
                        <div class="row mt-3 mb-3">
                            <div class="col-lg-6">
                                <label for="phoneUp" class="fw-bold">Phone</label>
                                <input type="text" id="phoneDel" name="phoneDel" class="form-control" readonly>
                            </div>
                            <div class="col-lg-6">
                                <label for="addressUp" class="fw-bold">Address</label>
                                <input type="text" id="addressDel" name="addressDel" class="form-control" readonly>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="btnDelete" class="btn btn-outline-danger">
                        <i class="fa-solid fa-pen-to-square"></i>
                        Delete
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Deposit modal -->
    <div class="modal fade" id="mdDeposit" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Deposit</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="frmDeposit" action="">
                        <div class="row mt-3">
                            <div class="col-lg-6">
                                <label for="idCus" class="fw-bold">Customer Id</label>
                                <input type="text" id="idCus" name="idCus" class="form-control" readonly>
                            </div>
                            <div class="col-lg-6">
                                <label for="fullNameCus" class="fw-bold">Full Name</label>
                                <input type="text" id="fullNameCus" name="fullNameCus" class="form-control" readonly>
                            </div>
                        </div>
                        <div class="row mt-3 mb-3">
                            <div class="col-lg-6">
                                <label for="balanceCus" class="fw-bold">Current balance ($)</label>
                                <input type="text" id="balanceCus" name="balanceCus" class="form-control" readonly>
                            </div>
                            <div class="col-lg-6">
                                <label for="transactionAmountDe" class="fw-bold">Transaction Amount ($)</label>
                                <input type="text" id="transactionAmountDe" name="transactionAmountDe"
                                    class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="btnDeposit" class="btn btn-outline-success">
                        <i class="fa fa-plus" aria-hidden="true"></i>
                        Deposit
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- End deposit modal -->

    <!-- Withdraw modal -->
    <div class="modal fade" id="mdWithdraw" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Witdraw</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="frmDeposit" action="">
                        <div class="row mt-3">
                            <div class="col-lg-6">
                                <label for="idCus" class="fw-bold">Customer Id</label>
                                <input type="text" id="idCus1" name="idCus" class="form-control" readonly>
                            </div>
                            <div class="col-lg-6">
                                <label for="fullNameCus" class="fw-bold">Full Name</label>
                                <input type="text" id="fullNameCus1" name="fullNameCus" class="form-control" readonly>
                            </div>
                            <input type="hidden" id="emailCus1">
                            <input type="hidden" id="phoneCus1">
                            <input type="hidden" id="addressCus1">
                        </div>
                        <div class="row mt-3 mb-3">
                            <div class="col-lg-6">
                                <label for="balanceCus" class="fw-bold">Current balance ($)</label>
                                <input type="text" id="balanceCus1" name="balanceCus" class="form-control" readonly>
                            </div>
                            <div class="col-lg-6">
                                <label for="transactionAmountWi" class="fw-bold">Transaction Amount ($)</label>
                                <input type="text" id="transactionAmountWi" name="transactionAmountWi"
                                    class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="btnWithdraw" class="btn btn-outline-warning">
                        <i class="fa fa-plus" aria-hidden="true"></i>
                        Withdraw
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- End withdraw modal -->

    <!-- Transfer modal -->
    <div class="modal fade" id="mdTransfer" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
        aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Transfer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="frmTransfer">
                        <fieldset class="row g-3">
                            <div class="form-group row">
                                <div class="mb-3 col-md-3">
                                    <label class="col-sm-12 col-form-label">Sender ID</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control" readonly="" id="senderId" name="idCus">
                                    </div>
                                </div>
                                <div class="mb-3 col-md-3">
                                    <label class="col-sm-12 col-form-label">Sender Name</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control valid" readonly="" id="senderName"
                                            name="idCus">
                                    </div>
                                </div>
                                <div class="mb-3 col-md-3">
                                    <label class="col-sm-12 col-form-label">Email</label>
                                    <div class="col-sm-12">
                                        <input type="email" class="form-control" readonly="" id="senderEmail"
                                            name="idCus">
                                    </div>
                                </div>
                                <div class="mb-3 col-md-3">
                                    <label class="col-sm-12 col-form-label">Sender balance</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control num-space" readonly="" id="senderBalance"
                                            name="idCus">
                                    </div>
                                </div>
                                <input type="hidden" id="senderPhone">
                                <input type="hidden" id="senderAddress">
                            </div>
                            <div class="form-group row mb-4">
                                <div class="mb-3 col-md-3">
                                    <label class="col-sm-12 col-form-label">Recipient ID</label>
                                    <div class="col-sm-12">
                                        <select class="form-select" id="selectRecipient">

                                        </select>
                                    </div>
                                </div>
                                <div class="mb-3 col-md-3">
                                    <label class="col-sm-12 col-form-label">Transfer Amount ($)</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control" id="transferAmount"
                                            name="transferAmount">
                                    </div>
                                </div>
                                <div class="mb-3 col-md-3">
                                    <label class="col-sm-12 col-form-label">Fees (%)</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control" id="fees" value="10" readonly="">
                                    </div>
                                </div>
                                <div class="mb-3 col-md-3">
                                    <label class="col-sm-12 col-form-label">Total amount of transaction ($)</label>
                                    <div class="col-sm-12">
                                        <input type="text" class="form-control num-space" readonly=""
                                            id="transactionAmountTr" name="transactionAmountTr">
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" id="btnTransfer" class="btn btn-outline-primary">
                        <i class="fa fa-plus" aria-hidden="true"></i>
                        Transfer
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- End transfer modal -->

    <script src="./assets/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="./assets/js/bootstrap.bundle.min.js"></script>
    <script src="./js/model.js"></script>
    <script src="./assets/node_modules/sweetalert2/dist/sweetalert2.all.min.js"></script>
    <script>
        let listCustomer = [];
        let customer;
        function init() {
            getAllCustomers();

        }
        init();

        function initTooltip() {
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
        }

        function getAllCustomers() {
            $.ajax({
                headers: {
                    "Accept": "application/json",
                    "Content-type": "application/json"
                },
                type: "GET",
                url: 'http://localhost:3000/customers'
            })
                .done((data) => {
                    drawCustomers(data);
                    listCustomer = data;
                })
                .fail((jqXHR) => {
                    console.log(jqXHR);
                });
        }

        function getCustomerById(id) {
            return $.ajax({
                headers: {
                    "Accept": "application/json",
                    "Content-type": "application/json"
                },
                type: "GET",
                url: 'http://localhost:3000/customers/' + id
            })
                .done((data) => {
                    customer = data;
                })
                .fail((jqXHR) => {
                    console.log(jqXHR);
                });
        }

        function removeEventShowUpdateModal() {
            $(".edit").off();
        }


        function drawCustomers(data) {
            $('#tbCustomer tbody').empty();
            $.each(data, (i, item) => {
                let str = `
                    <tr id="tr_${item.id}">
                        <td>${item.id}</td>
                        <td>${item.fullName}</td>
                        <td>${item.email}</td>
                        <td class="text-center">${item.phone}</td>
                        <td>${item.address}</td>
                        <td class="text-end">${item.balance}</td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-secondary edit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Update">
                                <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-success deposit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Deposit">
                                <i class="fa fa-plus" aria-hidden="true"></i>
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-warning withdraw" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Withdraw">
                                <i class="fa fa-minus" aria-hidden="true"></i>
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-primary transfer" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Transfer">
                                <i class="fa fa-exchange" aria-hidden="true"></i>
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-danger delete" data-bs-toggle="tooltip" data-id="${item.id}" data-bs-placement="top" data-bs-title="Delete">
                                <i class="fa fa-ban" aria-hidden="true"></i>
                            </button>
                        </td>
                    </tr>
                `;
                let tbCustomer = $('#tbCustomer tbody');
                tbCustomer.prepend(str);
            });

            initTooltip();

            removeEventShowUpdateModal();
            handleShowUpdateModal();

            handleShowDeleteModal();
            handleShowDepositModal();
            handleShowWithdrawModal();
            handleShowTransferModal();


        }

        let btnCreate = $('#btnCreate');

        btnCreate.on('click', () => {

            let fullName = $('#fullName').val();
            let email = $('#email').val();
            let phone = $('#phone').val();
            let address = $('#address').val();

            customer = new Customer(0, fullName, email, phone, address, 0, 0);
            delete customer.id;

            $.ajax({
                headers: {
                    "Accept": "application/json",
                    "Content-type": "application/json"
                },
                type: "POST",
                url: 'http://localhost:3000/customers',
                data: JSON.stringify(customer)
            })
                .done((item) => {
                    let str = `
                    <tr id="tr_${item.id}">
                        <td>${item.id}</td>
                        <td>${item.fullName}</td>
                        <td>${item.email}</td>
                        <td class="text-center">${item.phone}</td>
                        <td>${item.address}</td>
                        <td class="text-end">${item.balance}</td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-secondary edit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Update">
                                <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-success deposit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Deposit">
                                <i class="fa fa-plus" aria-hidden="true"></i>
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-warning withdraw" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Withdraw">
                                <i class="fa fa-minus" aria-hidden="true"></i>
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-primary transfer" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Transfer">
                                <i class="fa fa-exchange" aria-hidden="true"></i>
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-danger delete" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Delete">
                                <i class="fa fa-ban" aria-hidden="true"></i>
                            </button>
                        </td>
                    </tr>
                `;

                    let tbCustomer = $('#tbCustomer tbody');
                    tbCustomer.prepend(str);

                    initTooltip();
                    removeEventShowUpdateModal();
                    handleShowUpdateModal();
                    handleShowDeleteModal();
                    handleShowDepositModal();
                    handleShowWithdrawModal();
                    handleShowTransferModal();

                    Swal.fire({
                        // position: 'top-end',
                        icon: 'success',
                        title: 'Create customer succesfully',
                        showConfirmButton: false,
                        timer: 1500
                    })

                })
                .fail((jqXHR) => {
                    console.log(jqXHR);
                });

        });

        // show form update
        function handleShowUpdateModal() {

            let btnUpdate = $(".edit");

            btnUpdate.on('click', function () {
                let id = $(this).data('id');

                getCustomerById(id).then(() => {
                    $("#idUp").val(customer.id);
                    $("#fullNameUp").val(customer.fullName);
                    $("#emailUp").val(customer.email);
                    $("#phoneUp").val(customer.phone);
                    $("#addressUp").val(customer.address);
                    $("#balanceUp").val(customer.balance);

                    $("#mdUpdate").modal('show');
                })
                    .catch(() => {
                        Swal.fire({
                            title: "Customer information invalid",
                            icon: 'error',
                            showConfirmButton: false,
                            timer: 1500
                        })
                    });
            })
        }

        // update customer
        let btnUpdate = $("#btnUpdate");

        btnUpdate.on('click', () => {
            let customerId = +$("#idUp").val();
            let fullName = $('#fullNameUp').val();
            let email = $('#emailUp').val();
            let phone = $('#phoneUp').val();
            let address = $('#addressUp').val();
            let balance = $('#balanceUp').val();

            customer = new Customer(customerId, fullName, email, phone, address, balance, 0);

            $.ajax({
                headers: {
                    "Accept": "application/json",
                    "Content-type": "application/json"
                },
                type: "PUT",
                url: 'http://localhost:3000/customers/' + customerId,
                data: JSON.stringify(customer)
            })
                .done((item) => {

                    let str = `
                    <tr id="tr_${item.id}">
                        <td>${item.id}</td>
                        <td>${item.fullName}</td>
                        <td>${item.email}</td>
                        <td class="text-center">${item.phone}</td>
                        <td>${item.address}</td>
                        <td class="text-end">${item.balance}</td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-secondary edit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Update">
                                <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-success deposit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Deposit">
                                <i class="fa fa-plus" aria-hidden="true"></i>
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-warning withdraw" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Withdraw">
                                <i class="fa fa-minus" aria-hidden="true"></i>
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-primary transfer" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Transfer">
                                <i class="fa fa-exchange" aria-hidden="true"></i>
                            </button>
                        </td>
                        <td style="text-align: center;">
                            <button class="btn btn-outline-danger delete" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Delete">
                                <i class="fa fa-ban" aria-hidden="true"></i>
                            </button>
                        </td>
                    </tr>
                `;

                    let currentRow = $("#tr_" + item.id);
                    currentRow.replaceWith(str);

                    $("#mdUpdate").modal('hide');

                    initTooltip();
                    removeEventShowUpdateModal();
                    handleShowUpdateModal();
                    handleShowDeleteModal();
                    handleShowDepositModal();
                    handleShowWithdrawModal();
                    handleShowTransferModal();

                    Swal.fire({
                        // position: 'top-end',
                        icon: 'success',
                        title: 'Customer has been updated',
                        showConfirmButton: false,
                        timer: 1500
                    })
                })
                .fail((jqXHR) => {
                    console.log(jqXHR);
                });
        });



        // show info delete
        function handleShowDeleteModal() {

            let btnDelete = $("button.delete");

            btnDelete.on('click', function () {

                let id = $(this).data('id');
                getCustomerById(id).then(() => {
                    $("#idDel").val(customer.id);
                    $("#fullNameDel").val(customer.fullName);
                    $("#emailDel").val(customer.email);
                    $("#phoneDel").val(customer.phone);
                    $("#addressDel").val(customer.address);

                    $("#mdDelete").modal('show');
                })
                    .catch(() => {
                        Swal.fire({
                            title: "Customer information invalid",
                            icon: 'error',
                            showConfirmButton: false,
                            timer: 1500
                        })
                    });
            })
        }
        // Delete
        let btnDelete = $("#btnDelete");

        btnDelete.on('click', () => {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    let customerId = +$("#idDel").val();

                    $.ajax({
                        headers: {
                            "Accept": "application/json",
                            "Content-type": "application/json"
                        },
                        type: "DELETE",
                        url: 'http://localhost:3000/customers/' + customerId,
                    })
                        .done((data) => {
                            $('#tr_' + customerId).remove();
                            Swal.fire({
                                position: 'top-end',
                                icon: 'success',
                                title: 'Customer has been deleted',
                                showConfirmButton: false,
                                timer: 1500
                            })
                        })
                        .fail((jqXHR) => {
                            console.log(jqXHR);
                        });

                    $("#mdDelete").modal('hide');


                }
            })
        });

        // show form deposit
        function handleShowDepositModal() {

            let btnDeposit = $(".deposit");

            btnDeposit.on('click', function () {

                let id = $(this).data('id');

                getCustomerById(id).then(() => {
                    $("#idCus").val(customer.id);
                    $("#fullNameCus").val(customer.fullName);
                    $("#emailCus").val(customer.email);
                    $("#phoneCus").val(customer.phone);
                    $("#addressCus").val(customer.address);
                    $("#balanceCus").val(customer.balance);

                    $("#mdDeposit").modal('show');
                })
                    .catch(() => {
                        Swal.fire({
                            title: "Customer information invalid",
                            icon: 'error',
                            showConfirmButton: false,
                            timer: 1500
                        })
                    });
            })
        }
        // deposit
        let btnDeposit = $("#btnDeposit");
        let deposit;
        let depositId = 1;
        btnDeposit.on('click', () => {

            let customerId = +$("#idCus").val();
            let fullName = $('#fullNameCus').val();
            let balance = +$('#balanceCus').val();
            let transactionAmount = +$('#transactionAmountDe').val();

            let newBalance;

            newBalance = balance + transactionAmount;

            if (newBalance > 100000000000) {
                Swal.fire({
                    // position: 'top-end',
                    icon: 'warring',
                    title: 'Warring!',
                    text: "Please check balance limit or contact the administrator!",
                    showConfirmButton: true,
                    // timer: 1500
                })
                return;
            }

            deposit = new Deposit(0, customerId, transactionAmount);
            delete deposit.id;
            depositId++;

            $.ajax({
                headers: {
                    "Accept": "application/json",
                    "Content-type": "application/json"
                },
                type: "POST",
                url: 'http://localhost:3000/deposit',
                data: JSON.stringify(deposit)
            })
                .done((data) => {
                    $.ajax({
                        headers: {
                            "Accept": "application/json",
                            "Content-type": "application/json"
                        },
                        type: "PATCH",
                        url: 'http://localhost:3000/customers/' + customerId,
                        data: JSON.stringify({
                            "balance": newBalance
                        })
                    })
                        .done((item) => {
                            let str = `
                                <tr id="tr_${item.id}">
                                    <td>${item.id}</td>
                                    <td>${item.fullName}</td>
                                    <td>${item.email}</td>
                                    <td class="text-center">${item.phone}</td>
                                    <td>${item.address}</td>
                                    <td class="text-end">${item.balance}</td>
                                    <td>
                                        <button class="btn btn-outline-secondary edit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Update">
                                            <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-success deposit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Deposit">
                                            <i class="fa fa-plus" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-warning withdraw" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Withdraw">
                                            <i class="fa fa-minus" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-primary transfer" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Transfer">
                                            <i class="fa fa-exchange" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-danger delete" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Delete">
                                            <i class="fa fa-ban" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                </tr>
                            `;

                            let currentRow = $("#tr_" + item.id);
                            currentRow.replaceWith(str);

                            $("#mdDeposit").modal('hide');

                            initTooltip();
                            removeEventShowUpdateModal();
                            handleShowUpdateModal();
                            handleShowDeleteModal();
                            handleShowDepositModal();
                            handleShowWithdrawModal();
                            handleShowTransferModal();
                        })
                        .fail((jqXHR) => {
                            console.log(jqXHR);
                        });

                    Swal.fire({
                        // position: 'top-end',
                        icon: 'success',
                        title: 'Deposit Successfully',
                        showConfirmButton: false,
                        timer: 1500
                    })
                })
                .fail((jqXHR) => {
                    console.log(jqXHR);
                });





        });

        // show withdraw form
        function handleShowWithdrawModal() {

            let btnWithdraw = $(".withdraw");

            btnWithdraw.on('click', function () {

                let id = $(this).data('id');
                getCustomerById(id).then(() => {
                    $("#idCus1").val(customer.id);
                    $("#fullNameCus1").val(customer.fullName);
                    $("#emailCus1").val(customer.email);
                    $("#phoneCus1").val(customer.phone);
                    $("#addressCus1").val(customer.address);
                    $("#balanceCus1").val(customer.balance);

                    $("#mdWithdraw").modal('show');
                })
                    .catch(() => {
                        Swal.fire({
                            title: "Customer information invalid",
                            icon: 'error',
                            showConfirmButton: false,
                            timer: 1500
                        })
                    });
            })
        }
        // withdraw
        let btnWithdraw = $("#btnWithdraw");
        let withdraw;
        let withdrawId = 1;
        btnWithdraw.on('click', () => {

            let customerId = +$("#idCus1").val();
            let balance = +$('#balanceCus1').val();
            let transactionAmount = +$('#transactionAmountWi').val();

            let newBalance;
            if (balance >= transactionAmount) {
                newBalance = balance - transactionAmount;

                withdraw = new Withdraw(withdrawId, customerId, transactionAmount);
                delete withdraw.id;
                withdrawId++;


                $.ajax({
                    headers: {
                        "Accept": "application/json",
                        "Content-type": "application/json"
                    },
                    type: "POST",
                    url: 'http://localhost:3000/withdraw',
                    data: JSON.stringify(withdraw)
                })
                    .done((data) => {
                        $.ajax({
                            headers: {
                                "Accept": "application/json",
                                "Content-type": "application/json"
                            },
                            type: "PATCH",
                            url: 'http://localhost:3000/customers/' + customerId,
                            data: JSON.stringify({
                                "balance": newBalance
                            })
                        })
                            .done((item) => {
                                let str = `
                                <tr id="tr_${item.id}">
                                    <td>${item.id}</td>
                                    <td>${item.fullName}</td>
                                    <td>${item.email}</td>
                                    <td class="text-center">${item.phone}</td>
                                    <td>${item.address}</td>
                                    <td class="text-end">${item.balance}</td>
                                    <td>
                                        <button class="btn btn-outline-secondary edit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Update">
                                            <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-success deposit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Deposit">
                                            <i class="fa fa-plus" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-warning withdraw" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Withdraw">
                                            <i class="fa fa-minus" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-primary transfer" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Transfer">
                                            <i class="fa fa-exchange" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-danger delete" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Delete">
                                            <i class="fa fa-ban" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                </tr>
                            `;

                                let currentRow = $("#tr_" + item.id);
                                currentRow.replaceWith(str);

                                $("#mdWithdraw").modal('hide');

                                initTooltip();
                                removeEventShowUpdateModal();
                                handleShowUpdateModal();
                                handleShowDeleteModal();
                                handleShowDepositModal();
                                handleShowWithdrawModal();
                                handleShowTransferModal();
                            })
                            .fail((jqXHR) => {
                                console.log(jqXHR);
                            });

                        Swal.fire({
                            // position: 'top-end',
                            icon: 'success',
                            title: 'Withdraw Successfully',
                            showConfirmButton: false,
                            timer: 1500
                        })
                    })
                    .fail((jqXHR) => {
                        console.log(jqXHR);
                    });

            } else {
                Swal.fire({
                    title: "Oops...",
                    text: "Your balance not enough",
                    icon: 'error',
                    showConfirmButton: false,
                    timer: 2000
                })
            }


        });

        // show form transfer
        function handleShowTransferModal() {

            let btnTransfer = $(".transfer");

            btnTransfer.on('click', function () {

                let id = $(this).data('id');
                getCustomerById(id).then(() => {
                    $("#senderId").val(customer.id);
                    $("#senderName").val(customer.fullName);
                    $("#senderEmail").val(customer.email);
                    $("#senderBalance").val(customer.balance);
                    getRecipients(id);

                    $("#mdTransfer").modal('show');
                })
                    .catch(() => {
                        Swal.fire({
                            title: "Customer information invalid",
                            icon: 'error',
                            showConfirmButton: false,
                            timer: 1500
                        })
                    });
            })
        }

        function getRecipients(senderId) {
            $.ajax({
                headers: {
                    "Accept": "application/json",
                    "Content-type": "application/json"
                },
                type: "GET",
                url: 'http://localhost:3000/customers'
            })
                .done((data) => {
                    selectRecipient(data, senderId);
                })
                .fail((jqXHR) => {
                    console.log(jqXHR);
                });
        }

        function selectRecipient(data, senderId) {
            $('#selectRecipient').empty();
            $.each(data, (i, item) => {
                if (item.id != senderId) {
                    let str = `
                    <option value="${item.id}">
                        (${item.id}) - ${item.fullName}
                    </option>
                `;
                    let selectRecipient = $('#selectRecipient');
                    selectRecipient.append(str);
                }

            });
        }
        // transfer
        let btnTransfer = $("#btnTransfer");
        let transfer;
        let sender;
        let ricipient;
        let transferId = 1;

        $("#transferAmount").on("input", function () {
            let transferAmount = +$(this).val();
            let fees = 10;
            let feesAmount = transferAmount * fees / 100;
            let transactionAmount = transferAmount + feesAmount;

            $("#transactionAmountTr").val(transactionAmount);
        });

        btnTransfer.on('click', () => {

            let senderId = +$("#senderId").val();
            let senderName = $('#senderName').val();
            let senderEmail = $('#senderEmail').val();
            let balanceSender = +$('#senderBalance').val();

            let recipientId = +$("#selectRecipient").val();
            let recipientBalance;
            $.each(listCustomer, (i, item) => {
                if (item.id == recipientId) {
                    recipientBalance = item.balance;
                }
            });

            let transferAmount = +$('#transferAmount').val();
            let fees = +$("#fees").val();
            let feesAmout = transferAmount * fees / 100;
            let transactionAmount = transferAmount + feesAmout;
            let newBalanceSender;

            if (balanceSender >= transactionAmount) {
                newBalanceSender = balanceSender - transactionAmount;
                let newBalanceRicipient;

                newBalanceRicipient = recipientBalance + transferAmount;
                if (newBalanceRicipient > 50000000000) {
                    Swal.fire({
                        // position: 'top-end',
                        icon: 'warring',
                        title: 'Warring!',
                        text: "Please check the recipient's balance limit or contact the administrator!",
                        showConfirmButton: true,
                        // timer: 1500
                    })
                    return;
                }

                transfer = new Transfer(transferId, senderId, recipientId, fees, feesAmout, transferAmount, transactionAmount);
                delete transfer.id;
                transferId++;


                $.ajax({
                    headers: {
                        "Accept": "application/json",
                        "Content-type": "application/json"
                    },
                    type: "POST",
                    url: 'http://localhost:3000/transfer',
                    data: JSON.stringify(transfer)
                })
                    .done((data) => {
                        $.ajax({
                            headers: {
                                "Accept": "application/json",
                                "Content-type": "application/json"
                            },
                            type: "PATCH",
                            url: 'http://localhost:3000/customers/' + senderId,
                            data: JSON.stringify({
                                "balance": newBalanceSender
                            })
                        })
                            .done((item) => {
                                let str = `
                                <tr id="tr_${item.id}">
                                    <td>${item.id}</td>
                                    <td>${item.fullName}</td>
                                    <td>${item.email}</td>
                                    <td class="text-center">${item.phone}</td>
                                    <td>${item.address}</td>
                                    <td class="text-end">${item.balance}</td>
                                    <td>
                                        <button class="btn btn-outline-secondary edit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Update">
                                            <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-success deposit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Deposit">
                                            <i class="fa fa-plus" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-warning withdraw" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Withdraw">
                                            <i class="fa fa-minus" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-primary transfer" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Transfer">
                                            <i class="fa fa-exchange" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <button class="btn btn-outline-danger delete" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Delete">
                                            <i class="fa fa-ban" aria-hidden="true"></i>
                                        </button>
                                    </td>
                                </tr>
                            `;

                                let currentRow = $("#tr_" + item.id);
                                currentRow.replaceWith(str);

                                initTooltip();
                                removeEventShowUpdateModal();
                                handleShowUpdateModal();
                                handleShowDeleteModal();
                                handleShowDepositModal();
                                handleShowWithdrawModal();
                                handleShowTransferModal();

                                $.ajax({
                                    headers: {
                                        "Accept": "application/json",
                                        "Content-type": "application/json"
                                    },
                                    type: "PATCH",
                                    url: 'http://localhost:3000/customers/' + recipientId,
                                    data: JSON.stringify({
                                        "balance": newBalanceRicipient
                                    })
                                })
                                    .done((item) => {
                                        let str = `
                                            <tr id="tr_${item.id}">
                                                <td>${item.id}</td>
                                                <td>${item.fullName}</td>
                                                <td>${item.email}</td>
                                                <td class="text-center">${item.phone}</td>
                                                <td>${item.address}</td>
                                                <td class="text-end">${item.balance}</td>
                                                <td>
                                                    <button class="btn btn-outline-secondary edit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Update">
                                                        <i class="fa fa-pencil-square-o" aria-hidden="true"></i>
                                                    </button>
                                                </td>
                                                <td>
                                                    <button class="btn btn-outline-success deposit" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Deposit">
                                                        <i class="fa fa-plus" aria-hidden="true"></i>
                                                    </button>
                                                </td>
                                                <td>
                                                    <button class="btn btn-outline-warning withdraw" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Withdraw">
                                                        <i class="fa fa-minus" aria-hidden="true"></i>
                                                    </button>
                                                </td>
                                                <td>
                                                    <button class="btn btn-outline-primary transfer" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Transfer">
                                                        <i class="fa fa-exchange" aria-hidden="true"></i>
                                                    </button>
                                                </td>
                                                <td>
                                                    <button class="btn btn-outline-danger delete" data-id="${item.id}" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Delete">
                                                        <i class="fa fa-ban" aria-hidden="true"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        `;

                                        let currentRow = $("#tr_" + item.id);
                                        currentRow.replaceWith(str);

                                        initTooltip();
                                        removeEventShowUpdateModal();
                                        handleShowUpdateModal();
                                        handleShowDeleteModal();
                                        handleShowDepositModal();
                                        handleShowWithdrawModal();
                                        handleShowTransferModal();

                                        $("#mdTransfer").modal('hide');
                                        Swal.fire({
                                            // position: 'top-end',
                                            icon: 'success',
                                            title: 'Transfer Successfully',
                                            showConfirmButton: false,
                                            timer: 1500
                                        })
                                    })
                                    .fail((jqXHR) => {
                                        console.log(jqXHR);
                                    });

                            })
                            .fail((jqXHR) => {
                                console.log(jqXHR);
                            });
                    })
                    .fail((jqXHR) => {
                        console.log(jqXHR);
                    });
            } else {
                Swal.fire({
                    title: "Oops...",
                    text: "Your balance not enough",
                    icon: 'error',
                    showConfirmButton: false,
                    timer: 2000
                })
            }

        });
    </script>
</body>

</html>